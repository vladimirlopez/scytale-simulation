(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function l(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(o){if(o.ep)return;o.ep=!0;const s=l(o);fetch(o.href,s)}})();const h={faceHeight:60,defaultFaces:6,defaultMessage:"SCYTALE CIPHER",maxMessageLength:100},H=[{plaintext:"HELLO_SPARTAN",faces:3},{plaintext:"SCYTALE_IS_COOL",faces:3},{plaintext:"SECRET_MESSAGE",faces:4},{plaintext:"ATTACK_AT_DAWN",faces:4},{plaintext:"CRYPTOGRAPHY_RULES",faces:5}],a={message:h.defaultMessage,faces:h.defaultFaces,mode:"encode",rotationX:0,currentCiphertext:"",challengeIndex:0,challengeScore:0,shuffledChallenges:[],gameCompleted:!1},n={cylinder:document.getElementById("cylinder"),stripContent:document.getElementById("strip-content"),wrapper:document.getElementById("scytale-wrapper"),input:document.getElementById("message-input"),slider:document.getElementById("diameter-slider"),sliderVal:document.getElementById("diameter-value"),btnEncode:document.getElementById("mode-encode"),btnDecode:document.getElementById("mode-decode"),scene:document.querySelector(".scene-3d"),gridContent:document.getElementById("grid-content"),decodedMessage:document.getElementById("decoded-message"),charCount:document.getElementById("char-count"),charCounter:document.querySelector(".char-counter"),btnCopyStrip:document.getElementById("btn-copy-strip")};function F(t){const e=[...t];for(let l=e.length-1;l>0;l--){const c=Math.floor(Math.random()*(l+1));[e[l],e[c]]=[e[c],e[l]]}return e}function G(t,e){const l=t.replace(/[\r\n]+/g,""),c=e;let o=Math.ceil(l.length/c);o<1&&(o=1);let s={};for(let i=0;i<l.length;i++){const d=Math.floor(i/o),r=i%o;s[d]||(s[d]=[]),s[d][r]=l[i]}let f="";for(let i=0;i<o;i++)for(let d=0;d<c;d++)s[d]&&s[d][i]!==void 0&&(f+=s[d][i]);return f}function P(){try{console.log("Initializing Scytale Sim..."),n.input&&(n.input.value=a.message),n.slider&&(n.slider.value=a.faces),n.sliderVal&&(n.sliderVal.textContent=a.faces),x(),$(),A(),y(),k(),console.log("Initialization Complete.")}catch(t){console.error("Scytale Init Error:",t),alert("Simulation Error: "+t.message)}}function $(){const t=document.getElementById("btn-learn"),e=document.getElementById("btn-challenge"),l=document.querySelectorAll(".close-modal");t&&t.addEventListener("click",()=>document.getElementById("modal-learn").classList.remove("hidden")),e&&e.addEventListener("click",()=>{document.getElementById("modal-challenge").classList.remove("hidden"),a.gameCompleted&&T()});const c=()=>{const m=document.getElementById("modal-learn").querySelector("iframe");if(m){const p=m.src;m.src="",m.src=p}};l.forEach(g=>g.addEventListener("click",m=>{const p=m.target.closest(".modal");p.classList.add("hidden"),p.id==="modal-learn"&&c()})),window.addEventListener("click",g=>{g.target.classList.contains("modal")&&(g.target.classList.add("hidden"),g.target.id==="modal-learn"&&c())}),n.input&&(n.input.addEventListener("input",g=>{a.message=g.target.value,x(),y()}),n.input.addEventListener("paste",g=>{g.preventDefault();const p=(g.clipboardData||window.clipboardData).getData("text").replace(/[\r\n]+/g,""),E=n.input.selectionStart,I=n.input.selectionEnd,C=n.input.value,O=h.maxMessageLength-C.length+(I-E),S=p.slice(0,O),_=C.slice(0,E)+S+C.slice(I);n.input.value=_.slice(0,h.maxMessageLength),n.input.selectionStart=n.input.selectionEnd=E+S.length,a.message=n.input.value,x(),y()})),n.slider&&n.slider.addEventListener("input",g=>{a.faces=parseInt(g.target.value),n.sliderVal.textContent=a.faces,A(),y()}),n.btnEncode&&n.btnEncode.addEventListener("click",()=>v("encode")),n.btnDecode&&n.btnDecode.addEventListener("click",()=>v("decode")),n.btnCopyStrip&&n.btnCopyStrip.addEventListener("click",X);let o=!1,s=0,f=0;n.scene&&(n.scene.addEventListener("mousedown",g=>{o=!0,s=g.clientY,f=a.rotationX,n.scene.style.cursor="grabbing"}),window.addEventListener("mousemove",g=>{if(!o)return;const m=g.clientY-s;a.rotationX=f-m*.5,n.wrapper.style.transform=`rotateX(${a.rotationX}deg)`}),window.addEventListener("mouseup",()=>{o=!1,n.scene.style.cursor="grab"}));const i=document.getElementById("btn-submit-challenge");i&&i.addEventListener("click",w);const d=document.getElementById("btn-next-challenge");d&&d.addEventListener("click",Y);const r=document.getElementById("btn-reset-game");r&&r.addEventListener("click",T);const u=document.getElementById("btn-download-cert");u&&u.addEventListener("click",V);const L=document.getElementById("challenge-input");L&&L.addEventListener("keypress",g=>{g.key==="Enter"&&w()})}function x(){if(!n.charCount||!n.charCounter)return;const t=a.message.length;n.charCount.textContent=t,n.charCounter.classList.remove("warning","error"),t>=h.maxMessageLength?n.charCounter.classList.add("error"):t>=h.maxMessageLength*.8&&n.charCounter.classList.add("warning")}function X(){a.currentCiphertext&&navigator.clipboard.writeText(a.currentCiphertext).then(()=>{n.btnCopyStrip.classList.add("copied"),n.btnCopyStrip.textContent="âœ“ Copied!",setTimeout(()=>{n.btnCopyStrip.classList.remove("copied"),n.btnCopyStrip.textContent="ðŸ“‹ Copy Strip"},2e3)}).catch(t=>{console.error("Failed to copy:",t),alert("Failed to copy to clipboard")})}function v(t){a.mode=t,n.btnEncode.classList.toggle("active",t==="encode"),n.btnDecode.classList.toggle("active",t==="decode"),a.rotationX=0,n.wrapper&&(n.wrapper.style.transform="rotateX(0deg)"),y()}function A(){n.cylinder.innerHTML="";const t=a.faces,e=h.faceHeight,l=360/t,c=e/2/Math.tan(Math.PI/t);for(let o=0;o<t;o++){const s=document.createElement("div");s.className="face",s.style.height=`${e}px`,s.style.top="50%",s.style.marginTop=`-${e/2}px`,s.style.transform=`rotateX(${o*l}deg) translateZ(${c}px)`,s.id=`face-${o}`,n.cylinder.appendChild(s)}}function y(){const t=a.message.replace(/[\r\n]+/g,""),e=a.faces;document.querySelectorAll(".face").forEach(c=>{c.innerHTML="",c.style.borderLeft=""}),n.stripContent.innerHTML="";let l={};if(a.mode==="encode"){let c=Math.ceil(t.length/e);c<1&&(c=1);for(let s=0;s<t.length;s++){const f=Math.floor(s/c),i=s%c;l[f]||(l[f]=[]),l[f][i]=t[s]}let o="";for(let s=0;s<c;s++)for(let f=0;f<e;f++)l[f]&&l[f][s]!==void 0&&(o+=l[f][s]);a.currentCiphertext=o,B(o),b(l),D(l),M("")}else{const c=t;a.currentCiphertext=c;let o=Math.ceil(c.length/e);o<1&&(o=1);let s=new Array(e).fill(0),f=c.length;for(let r=0;r<e;r++){let u=Math.min(o,f);s[r]=u,f-=u}let i=0;for(let r=0;r<o;r++)for(let u=0;u<e;u++)r<s[u]&&i<c.length&&(l[u]||(l[u]=[]),l[u][r]=c[i++]);let d="";for(let r=0;r<e;r++)l[r]&&(d+=l[r].join(""));B(c),b(l),D(l),M(d)}}function b(t){const e=a.faces;let l=15;Object.values(t).forEach(c=>{c.length>l&&(l=c.length)});for(let c=0;c<e;c++){const o=document.getElementById(`face-${c}`);if(c===0){o.style.borderLeft="5px solid #d4af37";const i=document.createElement("div");i.textContent="START READING HERE",i.style.position="absolute",i.style.left="-140px",i.style.top="15px",i.style.color="#d4af37",i.style.fontSize="12px",i.style.fontWeight="bold",i.style.whiteSpace="nowrap",o.appendChild(i);const d=document.createElement("div");d.textContent="âž”",d.style.position="absolute",d.style.left="-20px",d.style.top="10px",d.style.color="#d4af37",d.style.fontSize="24px",o.appendChild(d)}else o.style.borderLeft="";const s=t[c]||[],f=Math.max(l,s.length);for(let i=0;i<f;i++){const d=s[i]||"",r=document.createElement("div");r.className="face-char",r.textContent=d,o.appendChild(r)}}}function B(t){if(t)for(let e=0;e<t.length;e++){const l=document.createElement("div");l.className="strip-char",l.textContent=t[e],n.stripContent.appendChild(l)}}function M(t){n.decodedMessage&&(!t||t.length===0?(n.decodedMessage.textContent="Switch to Decode mode to see the decoded message",n.decodedMessage.classList.add("empty")):(n.decodedMessage.textContent=t,n.decodedMessage.classList.remove("empty")))}function k(){a.shuffledChallenges=F(H),a.challengeIndex=0,a.challengeScore=0,a.gameCompleted=!1,R()}function R(){const t=a.shuffledChallenges[a.challengeIndex],e=G(t.plaintext,t.faces),l=document.getElementById("challenge-cipher"),c=document.getElementById("challenge-hint-faces"),o=document.getElementById("challenge-number"),s=document.getElementById("challenge-total"),f=document.getElementById("challenge-score"),i=document.getElementById("challenge-input"),d=document.getElementById("challenge-feedback"),r=document.getElementById("challenge-success"),u=document.getElementById("game-complete");l&&(l.textContent=e),c&&(c.textContent=t.faces),o&&(o.textContent=a.challengeIndex+1),s&&(s.textContent=a.shuffledChallenges.length),f&&(f.textContent=a.challengeScore),i&&(i.value=""),d&&d.classList.add("hidden"),r&&r.classList.add("hidden"),u&&u.classList.add("hidden")}function w(){const t=document.getElementById("challenge-input"),e=document.getElementById("challenge-feedback"),l=document.getElementById("challenge-success");if(!t)return;const c=a.shuffledChallenges[a.challengeIndex];t.value.toUpperCase().replace(/\s/g,"_")===c.plaintext?(a.challengeScore++,document.getElementById("challenge-score").textContent=a.challengeScore,e.classList.add("hidden"),l.classList.remove("hidden"),a.challengeIndex>=a.shuffledChallenges.length-1&&N()):(e.textContent="âŒ Incorrect! Try again. Hint: Use the simulator with "+c.faces+" faces in Decode mode.",e.classList.remove("hidden"),e.classList.add("incorrect"))}function Y(){a.challengeIndex++,a.challengeIndex>=a.shuffledChallenges.length?N():R()}function N(){a.gameCompleted=!0;const t=document.getElementById("challenge-success"),e=document.getElementById("game-complete"),l=document.getElementById("final-score"),c=document.getElementById("final-total");t&&t.classList.add("hidden"),e&&e.classList.remove("hidden"),l&&(l.textContent=a.challengeScore),c&&(c.textContent=a.shuffledChallenges.length)}function T(){k()}function V(){const t=document.createElement("canvas");t.width=800,t.height=600;const e=t.getContext("2d");e.fillStyle="#0f1115",e.fillRect(0,0,800,600),e.strokeStyle="#d4af37",e.lineWidth=10,e.strokeRect(20,20,760,560),e.strokeStyle="rgba(212, 175, 55, 0.3)",e.lineWidth=2,e.strokeRect(40,40,720,520),e.font="36px serif",e.fillStyle="#d4af37",e.textAlign="center",e.fillText("CERTIFICATE OF MASTERY",400,100),e.font="22px sans-serif",e.fillStyle="#e0e0e0",e.fillText("This certifies that the student has successfully",400,180),e.fillText("mastered the Spartan Scytale Cipher.",400,215),e.font="28px monospace",e.fillStyle="#fff",e.fillText(`Score: ${a.challengeScore}/${a.shuffledChallenges.length}`,400,300),e.font="60px sans-serif",e.fillText("ðŸ†",400,400),e.font="16px sans-serif",e.fillStyle="#aaa",e.fillText("Date: "+new Date().toLocaleDateString(),400,500),e.fillText("Scytale Cipher Simulation",400,530);const l=document.createElement("a");l.download="scytale_certificate.png",l.href=t.toDataURL(),l.click()}function D(t){if(!n.gridContent)return;n.gridContent.innerHTML="";const e=a.faces;let l=15;Object.values(t).forEach(c=>{c.length>l&&(l=c.length)});for(let c=0;c<e;c++){const o=document.createElement("div");o.className="grid-row",o.dataset.face=c+1;const s=t[c]||[],f=Math.max(l,s.length);for(let i=0;i<f;i++){const d=s[i]||"",r=document.createElement("div");r.className="grid-cell",i===0&&a.mode==="decode"&&r.classList.add("first-col"),r.textContent=d,o.appendChild(r)}n.gridContent.appendChild(o)}}P();
