(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function c(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=c(o);fetch(o.href,s)}})();const m={faceHeight:60,defaultFaces:6,defaultMessage:"SCYTALE CIPHER",maxMessageLength:100},_=[{plaintext:"HELLO_SPARTAN",faces:3},{plaintext:"SCYTALE_IS_COOL",faces:3},{plaintext:"SECRET_MESSAGE",faces:4},{plaintext:"ATTACK_AT_DAWN",faces:4},{plaintext:"CRYPTOGRAPHY_RULES",faces:5}],a={message:m.defaultMessage,faces:m.defaultFaces,mode:"encode",rotationX:0,currentCiphertext:"",challengeIndex:0,challengeScore:0,shuffledChallenges:[],gameCompleted:!1},l={cylinder:document.getElementById("cylinder"),stripContent:document.getElementById("strip-content"),wrapper:document.getElementById("scytale-wrapper"),input:document.getElementById("message-input"),slider:document.getElementById("diameter-slider"),sliderVal:document.getElementById("diameter-value"),btnEncode:document.getElementById("mode-encode"),btnDecode:document.getElementById("mode-decode"),scene:document.querySelector(".scene-3d"),gridContent:document.getElementById("grid-content"),decodedMessage:document.getElementById("decoded-message"),charCount:document.getElementById("char-count"),charCounter:document.querySelector(".char-counter"),btnCopyStrip:document.getElementById("btn-copy-strip")};function H(t){const e=[...t];for(let c=e.length-1;c>0;c--){const n=Math.floor(Math.random()*(c+1));[e[c],e[n]]=[e[n],e[c]]}return e}function F(t,e){const c=t.replace(/[\r\n]+/g,""),n=e;let o=Math.ceil(c.length/n);o<1&&(o=1);let s={};for(let i=0;i<c.length;i++){const r=Math.floor(i/o),d=i%o;s[r]||(s[r]=[]),s[r][d]=c[i]}let f="";for(let i=0;i<o;i++)for(let r=0;r<n;r++)s[r]&&s[r][i]!==void 0&&(f+=s[r][i]);return f}function G(){try{console.log("Initializing Scytale Sim..."),l.input&&(l.input.value=a.message),l.slider&&(l.slider.value=a.faces),l.sliderVal&&(l.sliderVal.textContent=a.faces),C(),P(),w(),h(),D(),console.log("Initialization Complete.")}catch(t){console.error("Scytale Init Error:",t),alert("Simulation Error: "+t.message)}}function P(){const t=document.getElementById("btn-learn"),e=document.getElementById("btn-challenge"),c=document.querySelectorAll(".close-modal");t&&t.addEventListener("click",()=>document.getElementById("modal-learn").classList.remove("hidden")),e&&e.addEventListener("click",()=>{document.getElementById("modal-challenge").classList.remove("hidden"),a.gameCompleted&&M()}),c.forEach(g=>g.addEventListener("click",p=>{p.target.closest(".modal").classList.add("hidden")})),l.input&&(l.input.addEventListener("input",g=>{a.message=g.target.value,C(),h()}),l.input.addEventListener("paste",g=>{g.preventDefault();const k=(g.clipboardData||window.clipboardData).getData("text").replace(/[\r\n]+/g,""),y=l.input.selectionStart,x=l.input.selectionEnd,E=l.input.value,N=m.maxMessageLength-E.length+(x-y),L=k.slice(0,N),O=E.slice(0,y)+L+E.slice(x);l.input.value=O.slice(0,m.maxMessageLength),l.input.selectionStart=l.input.selectionEnd=y+L.length,a.message=l.input.value,C(),h()})),l.slider&&l.slider.addEventListener("input",g=>{a.faces=parseInt(g.target.value),l.sliderVal.textContent=a.faces,w(),h()}),l.btnEncode&&l.btnEncode.addEventListener("click",()=>I("encode")),l.btnDecode&&l.btnDecode.addEventListener("click",()=>I("decode")),l.btnCopyStrip&&l.btnCopyStrip.addEventListener("click",$);let n=!1,o=0,s=0;l.scene&&(l.scene.addEventListener("mousedown",g=>{n=!0,o=g.clientY,s=a.rotationX,l.scene.style.cursor="grabbing"}),window.addEventListener("mousemove",g=>{if(!n)return;const p=g.clientY-o;a.rotationX=s-p*.5,l.wrapper.style.transform=`rotateX(${a.rotationX}deg)`}),window.addEventListener("mouseup",()=>{n=!1,l.scene.style.cursor="grab"}));const f=document.getElementById("btn-submit-challenge");f&&f.addEventListener("click",B);const i=document.getElementById("btn-next-challenge");i&&i.addEventListener("click",X);const r=document.getElementById("btn-reset-game");r&&r.addEventListener("click",M);const d=document.getElementById("btn-download-cert");d&&d.addEventListener("click",Y);const u=document.getElementById("challenge-input");u&&u.addEventListener("keypress",g=>{g.key==="Enter"&&B()})}function C(){if(!l.charCount||!l.charCounter)return;const t=a.message.length;l.charCount.textContent=t,l.charCounter.classList.remove("warning","error"),t>=m.maxMessageLength?l.charCounter.classList.add("error"):t>=m.maxMessageLength*.8&&l.charCounter.classList.add("warning")}function $(){a.currentCiphertext&&navigator.clipboard.writeText(a.currentCiphertext).then(()=>{l.btnCopyStrip.classList.add("copied"),l.btnCopyStrip.textContent="âœ“ Copied!",setTimeout(()=>{l.btnCopyStrip.classList.remove("copied"),l.btnCopyStrip.textContent="ðŸ“‹ Copy Strip"},2e3)}).catch(t=>{console.error("Failed to copy:",t),alert("Failed to copy to clipboard")})}function I(t){a.mode=t,l.btnEncode.classList.toggle("active",t==="encode"),l.btnDecode.classList.toggle("active",t==="decode"),a.rotationX=0,l.wrapper&&(l.wrapper.style.transform="rotateX(0deg)"),h()}function w(){l.cylinder.innerHTML="";const t=a.faces,e=m.faceHeight,c=360/t,n=e/2/Math.tan(Math.PI/t);for(let o=0;o<t;o++){const s=document.createElement("div");s.className="face",s.style.height=`${e}px`,s.style.top="50%",s.style.marginTop=`-${e/2}px`,s.style.transform=`rotateX(${o*c}deg) translateZ(${n}px)`,s.id=`face-${o}`,l.cylinder.appendChild(s)}}function h(){const t=a.message.replace(/[\r\n]+/g,""),e=a.faces;document.querySelectorAll(".face").forEach(n=>{n.innerHTML="",n.style.borderLeft=""}),l.stripContent.innerHTML="";let c={};if(a.mode==="encode"){let n=Math.ceil(t.length/e);n<1&&(n=1);for(let s=0;s<t.length;s++){const f=Math.floor(s/n),i=s%n;c[f]||(c[f]=[]),c[f][i]=t[s]}let o="";for(let s=0;s<n;s++)for(let f=0;f<e;f++)c[f]&&c[f][s]!==void 0&&(o+=c[f][s]);a.currentCiphertext=o,v(o),S(c),T(c),b("")}else{const n=t;a.currentCiphertext=n;let o=Math.ceil(n.length/e);o<1&&(o=1);let s=new Array(e).fill(0),f=n.length;for(let d=0;d<e;d++){let u=Math.min(o,f);s[d]=u,f-=u}let i=0;for(let d=0;d<o;d++)for(let u=0;u<e;u++)d<s[u]&&i<n.length&&(c[u]||(c[u]=[]),c[u][d]=n[i++]);let r="";for(let d=0;d<e;d++)c[d]&&(r+=c[d].join(""));v(n),S(c),T(c),b(r)}}function S(t){const e=a.faces;let c=15;Object.values(t).forEach(n=>{n.length>c&&(c=n.length)});for(let n=0;n<e;n++){const o=document.getElementById(`face-${n}`);if(n===0){o.style.borderLeft="5px solid #d4af37";const i=document.createElement("div");i.textContent="START READING HERE",i.style.position="absolute",i.style.left="-140px",i.style.top="15px",i.style.color="#d4af37",i.style.fontSize="12px",i.style.fontWeight="bold",i.style.whiteSpace="nowrap",o.appendChild(i);const r=document.createElement("div");r.textContent="âž”",r.style.position="absolute",r.style.left="-20px",r.style.top="10px",r.style.color="#d4af37",r.style.fontSize="24px",o.appendChild(r)}else o.style.borderLeft="";const s=t[n]||[],f=Math.max(c,s.length);for(let i=0;i<f;i++){const r=s[i]||"",d=document.createElement("div");d.className="face-char",d.textContent=r,o.appendChild(d)}}}function v(t){if(t)for(let e=0;e<t.length;e++){const c=document.createElement("div");c.className="strip-char",c.textContent=t[e],l.stripContent.appendChild(c)}}function b(t){l.decodedMessage&&(!t||t.length===0?(l.decodedMessage.textContent="Switch to Decode mode to see the decoded message",l.decodedMessage.classList.add("empty")):(l.decodedMessage.textContent=t,l.decodedMessage.classList.remove("empty")))}function D(){a.shuffledChallenges=H(_),a.challengeIndex=0,a.challengeScore=0,a.gameCompleted=!1,A()}function A(){const t=a.shuffledChallenges[a.challengeIndex],e=F(t.plaintext,t.faces),c=document.getElementById("challenge-cipher"),n=document.getElementById("challenge-hint-faces"),o=document.getElementById("challenge-number"),s=document.getElementById("challenge-total"),f=document.getElementById("challenge-score"),i=document.getElementById("challenge-input"),r=document.getElementById("challenge-feedback"),d=document.getElementById("challenge-success"),u=document.getElementById("game-complete");c&&(c.textContent=e),n&&(n.textContent=t.faces),o&&(o.textContent=a.challengeIndex+1),s&&(s.textContent=a.shuffledChallenges.length),f&&(f.textContent=a.challengeScore),i&&(i.value=""),r&&r.classList.add("hidden"),d&&d.classList.add("hidden"),u&&u.classList.add("hidden")}function B(){const t=document.getElementById("challenge-input"),e=document.getElementById("challenge-feedback"),c=document.getElementById("challenge-success");if(!t)return;const n=a.shuffledChallenges[a.challengeIndex];t.value.toUpperCase().replace(/\s/g,"_")===n.plaintext?(a.challengeScore++,document.getElementById("challenge-score").textContent=a.challengeScore,e.classList.add("hidden"),c.classList.remove("hidden"),a.challengeIndex>=a.shuffledChallenges.length-1&&R()):(e.textContent="âŒ Incorrect! Try again. Hint: Use the simulator with "+n.faces+" faces in Decode mode.",e.classList.remove("hidden"),e.classList.add("incorrect"))}function X(){a.challengeIndex++,a.challengeIndex>=a.shuffledChallenges.length?R():A()}function R(){a.gameCompleted=!0;const t=document.getElementById("challenge-success"),e=document.getElementById("game-complete"),c=document.getElementById("final-score"),n=document.getElementById("final-total");t&&t.classList.add("hidden"),e&&e.classList.remove("hidden"),c&&(c.textContent=a.challengeScore),n&&(n.textContent=a.shuffledChallenges.length)}function M(){D()}function Y(){const t=document.createElement("canvas");t.width=800,t.height=600;const e=t.getContext("2d");e.fillStyle="#0f1115",e.fillRect(0,0,800,600),e.strokeStyle="#d4af37",e.lineWidth=10,e.strokeRect(20,20,760,560),e.strokeStyle="rgba(212, 175, 55, 0.3)",e.lineWidth=2,e.strokeRect(40,40,720,520),e.font="36px serif",e.fillStyle="#d4af37",e.textAlign="center",e.fillText("CERTIFICATE OF MASTERY",400,100),e.font="22px sans-serif",e.fillStyle="#e0e0e0",e.fillText("This certifies that the student has successfully",400,180),e.fillText("mastered the Spartan Scytale Cipher.",400,215),e.font="28px monospace",e.fillStyle="#fff",e.fillText(`Score: ${a.challengeScore}/${a.shuffledChallenges.length}`,400,300),e.font="60px sans-serif",e.fillText("ðŸ†",400,400),e.font="16px sans-serif",e.fillStyle="#aaa",e.fillText("Date: "+new Date().toLocaleDateString(),400,500),e.fillText("Scytale Cipher Simulation",400,530);const c=document.createElement("a");c.download="scytale_certificate.png",c.href=t.toDataURL(),c.click()}function T(t){if(!l.gridContent)return;l.gridContent.innerHTML="";const e=a.faces;let c=15;Object.values(t).forEach(n=>{n.length>c&&(c=n.length)});for(let n=0;n<e;n++){const o=document.createElement("div");o.className="grid-row",o.dataset.face=n+1;const s=t[n]||[],f=Math.max(c,s.length);for(let i=0;i<f;i++){const r=s[i]||"",d=document.createElement("div");d.className="grid-cell",i===0&&a.mode==="decode"&&d.classList.add("first-col"),d.textContent=r,o.appendChild(d)}l.gridContent.appendChild(o)}}G();
