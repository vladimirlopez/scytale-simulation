(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const e of c)if(e.type==="childList")for(const d of e.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function s(c){const e={};return c.integrity&&(e.integrity=c.integrity),c.referrerPolicy&&(e.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?e.credentials="include":c.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function l(c){if(c.ep)return;c.ep=!0;const e=s(c);fetch(c.href,e)}})();const m={faceHeight:60,defaultFaces:6,defaultMessage:"SCYTALE CIPHER"},r={message:m.defaultMessage,faces:m.defaultFaces,mode:"encode",rotationX:0},n={cylinder:document.getElementById("cylinder"),stripContent:document.getElementById("strip-content"),wrapper:document.getElementById("scytale-wrapper"),input:document.getElementById("message-input"),slider:document.getElementById("diameter-slider"),sliderVal:document.getElementById("diameter-value"),btnEncode:document.getElementById("mode-encode"),btnDecode:document.getElementById("mode-decode"),scene:document.querySelector(".scene-3d"),gridContent:document.getElementById("grid-content"),decodedMessage:document.getElementById("decoded-message")};function T(){try{console.log("Initializing Scytale Sim..."),n.input&&(n.input.value=r.message),n.slider&&(n.slider.value=r.faces),n.sliderVal&&(n.sliderVal.textContent=r.faces),B(),S(),u(),console.log("Initialization Complete.")}catch(o){console.error("Scytale Init Error:",o),alert("Simulation Error: "+o.message)}}function B(){const o=document.getElementById("btn-learn"),t=document.getElementById("btn-challenge"),s=document.querySelectorAll(".close-modal");o&&o.addEventListener("click",()=>document.getElementById("modal-learn").classList.remove("hidden")),t&&t.addEventListener("click",()=>document.getElementById("modal-challenge").classList.remove("hidden")),s.forEach(i=>i.addEventListener("click",f=>{f.target.closest(".modal").classList.add("hidden")})),n.input&&(n.input.addEventListener("input",i=>{r.message=i.target.value,u()}),n.input.addEventListener("paste",i=>{i.preventDefault();const g=(i.clipboardData||window.clipboardData).getData("text").replace(/[\r\n]+/g,""),p=n.input.selectionStart,D=n.input.selectionEnd,h=n.input.value,y=h.slice(0,p)+g+h.slice(D);n.input.value=y,n.input.selectionStart=n.input.selectionEnd=p+g.length,r.message=y,u()})),n.slider&&n.slider.addEventListener("input",i=>{r.faces=parseInt(i.target.value),n.sliderVal.textContent=r.faces,S(),u()}),n.btnEncode&&n.btnEncode.addEventListener("click",()=>E("encode")),n.btnDecode&&n.btnDecode.addEventListener("click",()=>E("decode"));let l=!1,c=0,e=0;n.scene&&(n.scene.addEventListener("mousedown",i=>{l=!0,c=i.clientY,e=r.rotationX,n.scene.style.cursor="grabbing"}),window.addEventListener("mousemove",i=>{if(!l)return;const f=i.clientY-c;r.rotationX=e-f*.5,n.wrapper.style.transform=`rotateX(${r.rotationX}deg)`}),window.addEventListener("mouseup",()=>{l=!1,n.scene.style.cursor="grab"}));const d=document.getElementById("btn-submit-challenge");d&&d.addEventListener("click",N);const a=document.getElementById("btn-download-cert");a&&a.addEventListener("click",O)}function E(o){r.mode=o,n.btnEncode.classList.toggle("active",o==="encode"),n.btnDecode.classList.toggle("active",o==="decode"),r.rotationX=0,n.wrapper&&(n.wrapper.style.transform="rotateX(0deg)"),u()}function S(){n.cylinder.innerHTML="";const o=r.faces,t=m.faceHeight,s=360/o,l=t/2/Math.tan(Math.PI/o);for(let c=0;c<o;c++){const e=document.createElement("div");e.className="face",e.style.height=`${t}px`,e.style.top="50%",e.style.marginTop=`-${t/2}px`,e.style.transform=`rotateX(${c*s}deg) translateZ(${l}px)`,e.id=`face-${c}`,n.cylinder.appendChild(e)}}function u(){const o=r.message.replace(/[\r\n]+/g,""),t=r.faces;document.querySelectorAll(".face").forEach(l=>{l.innerHTML="",l.style.borderLeft=""}),n.stripContent.innerHTML="";let s={};if(r.mode==="encode"){let l=Math.ceil(o.length/t);l<1&&(l=1);for(let e=0;e<o.length;e++){const d=Math.floor(e/l),a=e%l;s[d]||(s[d]=[]),s[d][a]=o[e]}let c="";for(let e=0;e<l;e++)for(let d=0;d<t;d++)s[d]&&s[d][e]!==void 0&&(c+=s[d][e]);L(c),C(s),b(s),v("")}else{const l=o;for(let e=0;e<l.length;e++){const d=e%t,a=Math.floor(e/t);s[d]||(s[d]=[]),s[d][a]=l[e]}let c="";for(let e=0;e<t;e++)s[e]&&(c+=s[e].join(""));L(l),C(s),b(s),v(c)}}function C(o){const t=r.faces;let s=15;Object.values(o).forEach(l=>{l.length>s&&(s=l.length)});for(let l=0;l<t;l++){const c=document.getElementById(`face-${l}`);if(l===0){c.style.borderLeft="5px solid #d4af37";const a=document.createElement("div");a.textContent="START READING HERE",a.style.position="absolute",a.style.left="-140px",a.style.top="15px",a.style.color="#d4af37",a.style.fontSize="12px",a.style.fontWeight="bold",a.style.whiteSpace="nowrap",c.appendChild(a);const i=document.createElement("div");i.textContent="âž”",i.style.position="absolute",i.style.left="-20px",i.style.top="10px",i.style.color="#d4af37",i.style.fontSize="24px",c.appendChild(i)}else c.style.borderLeft="";const e=o[l]||[],d=Math.max(s,e.length);for(let a=0;a<d;a++){const i=e[a]||"",f=document.createElement("div");f.className="face-char",f.textContent=i,c.appendChild(f)}}}function L(o){if(o)for(let t=0;t<o.length;t++){const s=document.createElement("div");s.className="strip-char",s.textContent=o[t],n.stripContent.appendChild(s)}}function v(o){n.decodedMessage&&(!o||o.length===0?(n.decodedMessage.textContent="Switch to Decode mode to see the decoded message",n.decodedMessage.classList.add("empty")):(n.decodedMessage.textContent=o,n.decodedMessage.classList.remove("empty")))}const A="SL_CECY_OTIOASL",w=3,M="SCYTALE_IS_COOL",x=document.querySelector(".challenge-code");x&&(x.textContent=A);const I=document.getElementById("challenge-hint-faces");I&&(I.textContent=w);function N(){const o=document.getElementById("challenge-input");if(!o)return;o.value.toUpperCase().replace(/\s/g,"_")===M?document.getElementById("challenge-success").classList.remove("hidden"):alert("Incorrect! Try setting the rod faces to "+w+" and decoding.")}function O(){const o=document.createElement("canvas");o.width=800,o.height=600;const t=o.getContext("2d");t.fillStyle="#0f1115",t.fillRect(0,0,800,600),t.strokeStyle="#d4af37",t.lineWidth=10,t.strokeRect(20,20,760,560),t.font="40px Cinzel",t.fillStyle="#d4af37",t.textAlign="center",t.fillText("CERTIFICATE OF MASTERY",400,100),t.font="24px sans-serif",t.fillStyle="#e0e0e0",t.fillText("This certifies that the student has successfully",400,200),t.fillText("cracked the Spartan Scytale Cipher.",400,240),t.font="30px monospace",t.fillStyle="#fff",t.fillText(M,400,350),t.font="16px sans-serif",t.fillStyle="#aaa",t.fillText("Date: "+new Date().toLocaleDateString(),400,500);const s=document.createElement("a");s.download="scytale_certificate.png",s.href=o.toDataURL(),s.click()}function b(o){if(!n.gridContent)return;n.gridContent.innerHTML="";const t=r.faces;let s=15;Object.values(o).forEach(l=>{l.length>s&&(s=l.length)});for(let l=0;l<t;l++){const c=document.createElement("div");c.className="grid-row",c.dataset.face=l+1;const e=o[l]||[],d=Math.max(s,e.length);for(let a=0;a<d;a++){const i=e[a]||"",f=document.createElement("div");f.className="grid-cell",a===0&&r.mode==="decode"&&f.classList.add("first-col"),f.textContent=i,c.appendChild(f)}n.gridContent.appendChild(c)}}T();
